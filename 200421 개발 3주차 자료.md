## 200421 개발 3주차 자료
#### 3 주차 목표 : 1:N Model 연결/ 여러 app 연결/ 코드의 재사용 / Git
- 1 여러개의 app의 url 관리하기 위해 include
- 2 Model의 1:N 관계(foreing key) PK(Primory key)기본 의   이해
- 3 코드의 재사용
- 3 form으로 사용자 입력받고 DB에 저장하기

### 1 간단한 아주대 멋사8기 블로그를 만들어 볼게용

2주차에 model을 migrate해서 DB를 만들어주고 Data를 생성한 후 view로 처리해준 뒤 html로 보내봤죠?<br/>
app을 하나 더 만들어주고 model을 만들어 준 뒤 기존의 모델과 연결시키고, 앱의 url을 프로젝트에 연결해볼게요<br/>

#### 1 앱 만들기
```
/project 위치

python manage.py startapp post
```
#### 2 settings.py에 앱 등록해주기
```python

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'myapp',
    'post',
]
```
#### 3 post앱에 urls.py 만들기
```python
from django.urls import path
import post.views

urlpatterns = [
    path('', post.views.post_list, name = 'post_list'), 
    #''(공백) url이 들어오면 post_list 함수를 호출한다
]
```
#### 4 myproject urls에서 post/urls.py 연결해주기
```python
from django.contrib import admin
from django.urls import path, include   # include import 해주기
import myapp.views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', myapp.views.index, name = 'home'),
    path('lions/', myapp.views.lion_list, name = 'lions'),
    path('post/', include('post.urls')) 
    # post.urls를 include 해주는데 처음 url이 `post/` 가 된다   
]
```
나중엔 기능별로 앱이 생길텐데 project/urls.py에 모든 path를 관리하면 보기 안좋겠죠?<br/>
그래서 보통 app에다가 urls.py 를 만들어 주고 project/urls.py와 연결해줍니다<br/>
#### 5 이제 post/views.py에 함수를 작성하고 templates/post.html을 만들어줄게요
![캡처](https://user-images.githubusercontent.com/48672212/79643223-f0258380-81dc-11ea-8519-f1c536d99dc3.JPG)
<br/>
```python
# post/views.py
from django.shortcuts import render

def post_list(request):

    return render(request, 'post.html')
```
```html
<!-- templates/post.html --!>

<h2>하위</h2>
```
그리고 runserver를 돌려서 url 뒤에 /post를 쳐주면`하위가 나오죠?`<br/>
post/urls.py와 myproject/urls.py에서 처리해준것 같이 post.html을 요청해줍니다<br/>
이제 post 앱에도 model을 만들고 makemigrations -> migrate 해서 DB를 만들어줄게요 <br/>
#### 6 post앱에 model 만들기
```python
# post/models.py

from django.db import models
from django.utils import timezone

# Create your models here.

class Post(models.Model):
    title = models.CharField(max_length = 100)      # 제목
    content = models.TextField(max_length = 200)    # 내용
    create_data = models.DateTimeField(default = timezone.now)
    objects = models.Manager()  # 저번시간에 말해준 Manager인데 다시한번 집고 넘어가
    
    def __str__(self):    # 얘는 데이터 생성 시 생성값을 title 칼럼으로 해준다는 것
        return str(self.title)
```
`python manage.py makemigrations`랑`python manage.py migrate`ㄱㄱ<br/><br/>
아 근데 해주고 싶은게 있어요<br/>
저번에 Lion 모델에서 생성한 객체들이 이 Post 모델을 이용해서 글을 작성하게 하고 싶어요<br/>
보통 한 사람이 여러개의 글을 작성하죠 ? <br/>
그러려면 Lion 모델과 Post 모델을 1 : N으로 묶어주면 됩니다 <br/><br/>
`뭔소리야?`<br/>
![sag](https://user-images.githubusercontent.com/48672212/79643539-5e1e7a80-81de-11ea-94e0-ec315176803c.JPG)
<br/>
저번에 이렇게 Lion 모델을 만들어 줬죠? Post 모델도 똑같아요<br/>
![asgsag](https://user-images.githubusercontent.com/48672212/79643642-ef8dec80-81de-11ea-842c-b7476d193ec6.JPG)
<br/>
Post 모델도 이렇게 만들어지는데 아까 뭐라그랬죠?<br/>
한 사람이 여러개의 글을 쓰도록 만들게 하자고 했죠 ? <br/>
<br/>
![agsageg](https://user-images.githubusercontent.com/48672212/79643732-4d223900-81df-11ea-8471-832c13b6e890.JPG)
<br/>
이렇게 Post모델에 최광일 소유를 부여해서 여러개의 글을 작성하도록 할 수 있어요<br/>
Post 모델에 뭐가 추가됬죠 ? 최광일이가 추가됬죠? 그럼 Post 모델에 name 칼럼을 추가하면 되겠네요?
#### 7 FK(Forein key)로 1 : N Model 연결
```
# post/models.py

class Post(models.Model):
    name = models.ForeignKey (Lion, on_delete=models.CASCADE)   # 추가
    title = models.CharField(max_length = 100)
    content = models.TextField(max_length = 200)
    create_data = models.DateTimeField(default = timezone.now)
    objects = models.Manager()
    
    def __str__(self):
        return str(self.title)
```
1 : N 관계로 모델을 묶을때는 이렇게 models.ForeignKey 를 사용해줍니다<br/>
`왜냐구요 ? django한테 물어보세요 걔가 Class로 만들어논거에요...`<br/>
근데 뒤에 뭐가 붙었죠 ? ForeignKey field 값엔 여러가지가 있는데 2가지만 알아볼게여 <br/>
먼저 ForeignKey 에는 Post모델과 연결해줄 모델(Lion)을 연결해주고 on_delete라는 걸 해주는데 <br/>
lion 한명이 여러 post를 작성할 수 있다고 했죠 ? 근데 lion 한명의 데이터를 지우면 걔가 작성한 <br/>
post 모델의 데이터들은 어떻게 될까요 ? 상식적으로 없어져야겟죠 ? <br/>
그런데 장고는 인간이 아니라서 그걸 알려줘야 하는데 그게 `on_delete=models.CASCADE` 입니다.
<br/>
<br/>
그러면 이제 admin에서 post data를 만들고 view를 통해 templates으로 넘겨줘볼게요<br/>
#### 8 views.py and templates
```python
# post/views.py

from django.shortcuts import render
from post.models import Post    # post모델 임포트

# Create your views here.

def post_list(request):

    post_list = Post.objects.all()  # Post 모델에있는 객체 다 가져와

    return render(request, 'post.html', {'post_list' : post_list})  # 변수 넘겨줘
```
근데 lion 객체마다 글을 쓴 사람도 있고 안 쓴 사람도 있겠죠?<br/>
if 문을 통해 처리해봅시다
```html
post/templates/post.html

{% if post_list %}                              <!-- 작성한 글이 있다면 --!>
        {% for post in post_list %}             <!-- for 문 돌려 --!>
        <div class = "post">
            <div class = "post_container">
                <div class = "post_header">
                    <h2>{{post.pk}}번째 포스트 입니다</h2>
                    <p>작성자 : {{post.name}}<p>    
                </div>
                <div class = "post_center">
                    <p>제목 : {{post.title}}</p>
                    <p>내용 : {{post.content}}</p>
                </div>
                <div class = "post_bottom">
                    <p>작성시각 : {{post.create_data}}</p>
                </div>
            </div>
        </div>
        {% endfor %}                            <!-- for 문 끝 --!>
    {% else %}                                  <!-- 작성한 글이 없다면 --!>
        <h2>작성된 Post가 없습니다</h2>
{% endif %}                                     <!-- if 끝 --!>
```

