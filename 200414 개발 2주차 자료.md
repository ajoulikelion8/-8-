## 200414 개발 2주차 자료
#### 2주차 목표 : MTV pattern과 ORM을 이해한다
- 1 staticfiles(css 연결)
- 2 url-view-templates 의 관계를 이해하고 html에 나타낼 데이터를 처리하는 view를 공부 <br/>
    : 환율계산 페이지 실습 (Templates - view - url)
- 3 view에서 처리하는 데이터를 관리하기 위한 DB를 장고에서 처리해보기 <br/>
    : Django MTV pattern & ORM (Model) / admin page
- 4 DB(model)에서 데이터를 가져와 view에서 처리해준 후 html에 나타내기 <br/>
    : 아주대 멋사 8기 페이지 실습 (Model - View - Templates)
    
## 1 django project/ app/ hello world에 대한 이해

## 2 static(css 연결)
### 1 ) Static File과 Media File
- static file<br/>
: Javascript, CSS, Image 파일처럼 웹 서비스에서 사용하려고 개발자가 미리 준비해 놓은 <strong>정적 파일</strong><br/>
파일 자체가 고정되어 있고, 서비스 중에도 수시로 추가되거나 변경되지 않고 고정되어있음<br/>
- media File<br/>
이용자가 웹에서 올리는(upload) 파일. <br/>

### 2 ) Static File 을 알아보자
Static file은 <strong>개발자가 웹 서비스에 사용할 정적 파일을 미리 준비하여 제공</strong>하는 데 사용<br/><br/>
Django로 운영되는 프로젝트의 설정을 관리하는 settings.py에 Static file에 보통은 다음 <strong>세 가지</strong>를 사용함<br/>
- 1 ) STATICFILES_DIRS
- 1 ) STATIC_URL
- 1 ) STATIC_ROOT

#### 1) STATICFILES_DIRS
<strong>개발 단계</strong>에서 사용하는 정적 파일이 위치한 경로들을 지정하는 설정 항목
```python
#settings.py

STATICFILES_DIRS = (
    os.path.join(BASE_DIR, 'static'), # 쉼표 빠뜨리면 오류뜬다...장고시바
)
```
#### 2) STATIC_URL
: 웹 페이지에서 사용할 정적 파일의 최상위 URL 경로<br/>
이 최상위 경로 자체는 실제 파일이나 디렉터리가 아니며, URL로만 존재하는 단위임<br/>
정적 파일 경로에 STATIC_URL 경로를 합치면 실제 웹에서 접근 가능한 URL이 된다<br/><br/>
`뭔말이냐!!!`<br/><br/>
![assegaegs](https://user-images.githubusercontent.com/48672212/79071834-be15ac80-7d18-11ea-89b3-9836dfacbcb3.JPG)
<br/>
이렇게 `settings.py` 에 `static_url = '/static/'`되어있고<br/>
`static/css/img` 경로에 `1.png` 파일이 있죠?<br/>

![asegs](https://user-images.githubusercontent.com/48672212/79071607-9f62e600-7d17-11ea-9524-e1bb39e82388.JPG)

runserver를 돌리고 url에 다음과 같이 이미지 파일 경로를 적어주면 사진이 뜹니다<br/><br/>
#### 3) STATIC_ROOT
: 이건 배포할때 필요하니 우선 넘어가

### 3 ) Static File 을 적용
#### 1 ) settings.py 에 STATICFILES_DIRS 지정
이제부터 HTML 내에서 정적 파일을 호출할 때, 모든 파일을 static 폴더 안에서 찾겠다!
```python
#settings.py

STATICFILES_DIRS = (
    os.path.join(BASE_DIR, 'static'), 
)
```
#### 2 ) app이나 project 폴더 내부에 static폴더/css폴더 생성하고 css파일 생성
![asegseag](https://user-images.githubusercontent.com/48672212/79071366-54949e80-7d16-11ea-968a-b56afb4ad074.JPG)
<br/>
#### 3 ) html에 static 파일들을 가져와서 link 해주기
![asgsg](https://user-images.githubusercontent.com/48672212/79071435-b48b4500-7d16-11ea-9953-1e7a83097ee8.JPG)
<br/>
`{% load static %}`란?<br/>
: head 태그에서 <link>로 css파일을 호출해야하는데 그 전에 정적 파일 경로(static폴더)에 있는 모든 파일을 불러와라 <br/>
`<link>`란? <br/>
: 이 html에 해당 css파일을 연동하겠다 <br/>

## 2 환율계산 페이지 실습 (Templates - view - url)
### 1 ) 쉬운버전

### 2 ) 크롤링 활용 버전

## 3 Django MTV pattern & ORM (Model) / admin page(관리자 페이지)
### 1 ) ORM(Object Relational Mapping)
django에서 python으로 만든 class 객체로 데이터 베이스를 만들어 주는 것<br/><br/>
`객체가 몬데?`
<br/><br/>
#### 객체(Object)와 인스턴스(Inctance)
C언어에서는 구조체(Struct) / JAVA나 python 에서는 Class 입니다<br/><br/>

붕어빵을 만드는 과정에 비유를 해보면<br/>
붕어빵을 하나씩 조각해서 만드는게 아니라 틀에 넣고 찍으면 바로 나오죠?
<br/>
![다운로드](https://user-images.githubusercontent.com/48672212/79093279-be508f00-7d8e-11ea-9cde-5911410917ec.jpg)
<br/>
이걸 학생으로 표현하면 다음과 같습니다
<br/>
![12312312421](https://user-images.githubusercontent.com/48672212/79093346-f48e0e80-7d8e-11ea-85e9-12a7f336728e.png)
<br/>
학생 정보를 DB에 저장할때 한명한명 하나씩 정보를 입력해주는게 아니라 <br/>
정보를 입력할 틀을 만들어 놓고 정보만 입력하면 되도록 하는 것입니다
<br/><br/>
Django에서도 이 객체(붕어빵 틀)를 사용해서 인스턴스(붕어빵)들을 DB에 데이터를 저장하는데, <br/>
django는 <strong>python</strong> 을 사용하니 <strong>Class</strong>를 통해 <strong>객체</strong>를 사용해서 인스턴스를 만들어줍니다
<br/><br/>
![214124124](https://user-images.githubusercontent.com/48672212/79094145-81d26280-7d91-11ea-82db-e48414bdcbc7.JPG)
그래서 이 Class를 작성해주는 곳이 Models.py 인 Model이고<br/>
Django는 이 Class model을 가지고 SQLlite로 DB를 만들어 줍니다<br/><br/>
![123124124](https://user-images.githubusercontent.com/48672212/79093869-92360d80-7d90-11ea-95a0-2a1be5783210.png)
<br/><br/>
만약 Django에서 Model을 만들지 않았다면 <br/>
DB 언어인 SQL을 또 공부해서 DB를 만들어야 해요<br/>
Model이 있어서 정말 다행이죠? `Thanks Django`<br/><br/>
![Django_ORM_600](https://user-images.githubusercontent.com/48672212/79093692-01f7c880-7d90-11ea-97ea-808f38a0ba86.png)
<br/><br/>
### 2 ) MTV pattern
그러면 이제 model에서 데이터를 만들고 view에서 가져와서 처리를 한 후 Templates에 보여줘야겠죠?<br/>
이러한 처리 과정을 Model - View - Templates 라고 표현해준 거에요 별거 없습니다<br/><br/>
![123123](https://user-images.githubusercontent.com/48672212/79093978-ed680000-7d90-11ea-91c0-fb0c83aa1f65.png)
<br/><br/>
환율계산 실습을 해보면서 url - view - templates의 과정을 알았는데 <br/>
데이터를 저장하는 곳은 없었죠 ? <br/>
이제 model을 사용해서 데이터를 관리하고 view에서 처리해준 다음 rending 페이지에 보여줍시다

## 4 아주대 멋사 8기 페이지 실습 (MTV, Templates Tag, Django admin site)
#### 알아야 할 것
- 1 ) Django의 Model을 이용해 DB를 만들고 ADMIN 페이지에서 데이터를 관리해준다
- 2 ) Django의 Templates Tag를 사용하여 HTML에서 변수, 논리처리(for, if) 해주기
- 3 ) model에서 쿼리셋 view로 가져와서 templates으로 변수 넘겨주는 과정 이해

### 같이 해보죠
### 1) hello world 먼저 띄우기
- 가상환경 설치 `python -m venv myvenv`
- 가상환경 구동 `source myvenv/Scripts/Activate`
- Django 설치 `pip install django`
- Project 만들기 `django-admin startproject myproject`
- Project 폴더로 가기 `cd myproject`
- app 만들기 `python manage.py startapp myapp`
- myproject/settings.py에 앱 등록하기
```python
# myproject/settings.py

# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'myapp',
]
```
- myapp/views.py 에 함수 
```python
# myapp/views.py

def index(request): # request가 들어온걸
    return render(request, 'index.html') # index.html을 render해준다
```
- myapp/templates 폴더 만들고 index.html 파일 만들기
- myproject/urls.py 에 path 설정
```python
# myproject/urls.py

from django.contrib import admin
from django.urls import path
import myapp.views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', myapp.views.index, name = 'home'),
    # 공백 url이 request되면 myapp.views에 있는 index 함수를 호출해라
]
```
#### 이제 manage.py 가 있는 폴더 위치에서 runserver하면 hello world가 되죠?
### 2 ) 모델작성과 migrate으로 DB생성 및 admin site 등록
```python
# myapp/models.py

from django.db import models
from django.utils import timezone

class Lion(models.Model):
# models.Model을 상속받아서 다음과같이 해주면 ORM으로 DB만들어 줌

    name = models.CharField(max_length = 100)  # 이름
    age = models.IntegerField() # 나이
    create_data = models.DateTimeField(default = timezone.now) # 생성날짜

    def __str__(self):
        return str(self.name)
```
근데 이렇게 써준다고 해서 DB가 만들어지지 않아요<br/>
<strong>Django 한테 나 model 만들었어요!
</strong>라고 말을 해줘야 이 작성된 클래스를 가지고 DB를 만들어 줍니다<br/><br/>
먼저 내가 등록할 것(migrations)을 생성하고<br/> `python manage.py makemigrations`<br/>
다음에 내가 등록할 것(migrations)을 적용시켜줍니다<br/> `python manage.py migrate`<br/><br/>

![12312](https://user-images.githubusercontent.com/48672212/79061307-e2966800-7cc9-11ea-84b3-aa2dc5e0a49d.JPG)
<br/><br/>
그럼 이렇게 될 거에요, 여러분은 DB를 만드신 겁니다.<br/><br/>
![12421](https://user-images.githubusercontent.com/48672212/79062203-f5616a80-7cd2-11ea-9fb7-408cf4780ed9.JPG)
<br/><br/>
이런 표는 많이들 보셨죠?<br/>
이렇게 관계형 데이터 형태인 row와 column 형태로 만들어 주는거에요
<br/>
그럼 장고에서 제공해주는 관리자 페이지에서 확인해볼게요<br/>
<br/>
먼저 관리자 페이지인 admin site에 나의 모델을 작성한 app을 등록시켜줘야해요
```python
# myapp/apps.py

from django.contrib import admin
from myapp.models import Lion # 모델을 가져와서

admin.site.register(Lion) # admin site에 register 해준다
```
그러면 기존에 myproject/urls에 작성된 path를 통해 관리자 페이지로 이동가능합니다<br/>
runserver를 하고 url 뒤에 /admin 을 쳐주면 관리자 페이지가 나타납니다. <br/><br/>
로그인 할 관리자가 필요하니 관리자부터 만들어 볼게요<br/>
콘솔창에서 admin 관리자인 SuperUser을 생성해서 데이터를 관리해볼게요<br/><br/>
![123](https://user-images.githubusercontent.com/48672212/79061244-00170200-7cc9-11ea-946c-f6ad496b59f1.JPG)
<br/><br/>
이제 로그인 해주면~<br/><br/>
![12412](https://user-images.githubusercontent.com/48672212/79061400-eecef500-7cca-11ea-8a10-8a7e385508b4.JPG)
<br/><br/>
이렇게 내가 model을 작성하고 migrate하고 admin사이트에 등록해준 Lion 모델이 나오죠?
<br/>
여길 들어가보면
<br/>
![agseg](https://user-images.githubusercontent.com/48672212/79061442-59803080-7ccb-11ea-9da6-4ab59da0cfe3.JPG)
<br/>
다음과 같이 내가 작성한 column인 name과 age를 작성해 줄 수 있어요/ 만들어주면<br/><br/>
![saegsaegse](https://user-images.githubusercontent.com/48672212/79062259-81739200-7cd3-11ea-8aa4-6185e74d460c.JPG)
<br/><br/>
다음과 같이 DB에 저장되고
<br/><br/>
![asiegji](https://user-images.githubusercontent.com/48672212/79061477-a49a4380-7ccb-11ea-884f-5e2f3083ca8d.JPG)
<br/><br/>
이렇게 우리 아기사자들을 만들어줄 수 있어요

### 3 ) 생성한 데이터를 Views.py에서 처리해주기
우리는 이제 무려 데이터를 만들었으니 이것들을 html파일에 표현해야죠?<br/>
생성한 데이터를 Views.py에서 처리해서 templates인 html로 보내야해요<br/>
```python
# myapp/views.py
from django.shortcuts import render
from myapp.models import Lion # 등록한 model인 Lion을 import 해주고

# lion에 등록한 이름들을 보여줄 html을 lions.html에 보여주기 위해 다음과 같이 해줍니다
def lion_list(request): 
    lion_list = Lion.objects.all()  # Lion모델에있는 objects(이름)를 all(모두) 가져와라

    return render(request, 'lions.html', {'lion_list' : lion_list})
    # lions.html에 render 해줄껀데 선언하고 할당해준 lion_list 변수를 html에 넘겨주기 위해
    # 다음과 같이 해줍니다
```
Views.py를 작성했으면 urls.py 에서 path 처리를 해줘야 겠죠?<br/>
```python
from django.contrib import admin
from django.urls import path
import myapp.views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', myapp.views.index, name = 'home'),
    path('lions/', myapp.views.lion_list, name = 'lions'),
    # url에 'lions/'이 입력되면 myapp/views.py에 있는 lion_list 함수를 호출해준다
]
```
그러면 이제 html에서 lion_list 변수를 사용해 주면 됩니다<br/>

### 4) views.py 에서 처리한 데이터를 templates에 보내서 웹에 표현하기
views.py 에서 lions.html에 'lion_list' 변수를 넘겨 주라고 했죠?<br/>
이 넘겨준 변수를 사용하기 위해서는 Django 에서 제공하는 Templates Tag를 알아야 해요
<br/><br/>
html은 프로그래밍 언어가 아니라 hyper text markup language라서<br/>
변수를 선언해주거나 if와 for같은 논리가 없어요<br/>
그래서 django에서 템플릿 테그에 python 논리를 담아서 html에서 사용할 수 있도록 만든겁니다<br/><br/>

```html
<body>
    <div class = "header">
        <h1>여기에 아기사자들 가져와</h1>
    </div>
    <div>
        <a href = "{% url 'home' %}">뒤로가기</a>
    </div>
    <!-- views에서 넘겨준 lion_list를 for 처리 해준다 --!>
    {% for lion in lion_list %} 

        <div class = "lion">
            <!-- lion은 lion_list에서 하나의 객체를 가르켜요 --!>
            <h1>{{ lion.name }}</h1>
            <p>가입 날짜 : {{ lion.create_data }}</p>
        </div>

    {% endfor %}

</body>
```
html에서 for 문을 사용하기 위해 장고가 python으로 처리해준 것을 사용한 것이 <br/>
`{% for lion in lion_list %}` 와 `{% endfor %}` 이부분이구요 / 이건 장고에서 만든거라 이렇게 사용해야해요<br/><br/>
내가 변수를 사용하고 싶으면 변수를 `{{ <변수 이름> }}` 이런식으로 해주면 됩니다
<br/><br/>
아마 for문은 여러분이 더 잘 아실꺼에요 <br/>
`for item in array`는 array 배열에서 각 item을 처리해주라는 거죠?<br/>
그리고 각 아이템은 우리가 만들어준 모델의 칼럼들을 가지고 있죠. name, create_data, age <br/>
그것들을 적용시키기 위해서는 dot(.)이라는 메소드를 사용해주면 됩니다<br/>
